
<html><head>
  <title>Module: SecureRandom</title>
  <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
  <link rel="stylesheet" href=".././rdoc-style.css" type="text/css" media="screen" />
  <script type="text/javascript" language="JavaScript">
  <!--
  function popCode(url) {
    parent.frames.source.location = url
  }
  //-->
  </script>
</head>
<body bgcolor="white">


<table width="100%" border="0" cellspacing="0">
 <tr class="title-row">
 <td class="big-title-font">
   <font size="-3"><b>Module</b><br /></font>SecureRandom
 </td>
 <td align="right">
   <table cellspacing="0" cellpadding="2">
     <tr valign="top">
      <td class="small-title-font">In:</td>
      <td class="small-title-font">
<a href="../files/lib/secure_random_rb.html">lib/secure_random.rb</a>
      </td>
     </tr>
   </table>
  </td>
  </tr>
</table><br />
  <!-- banner header -->





<div class="indent">
<div class="methods">
<table class="tablemethods" cellpadding="5" width="100%">
<tr><td class="tablesubtitle">Methods</td></tr>
</table>
<div class="name-list">
<ul>
<li><a href="#M000009">base64</a>
<li><a href="#M000008">hex</a>
<li><a href="#M000007">random_bytes</a>
<li><a href="#M000010">random_number</a>
</ul>
</div>
</div>
</div>


    <div class="indent">
    <div id="section">



  

<!--IF:method_list-->
<div class="method_list">
<!--START:method_list-->
<!--IF:methods -->
<h2>Public Class methods</h2>
<div class="methods">
<!--START:methods-->
<h2 class="methodname"><a name="M000009">

 <b>base64</b>(n=nil)
</a>
</h2>

<!--IF:m_desc-->
<div class="description">
<p>
<a href="SecureRandom.html#M000009">SecureRandom.base64</a> generates a
random <a href="SecureRandom.html#M000009">base64</a> string.
</p>
<p>
The argument n specifies the length of the random length. The length of the
result string is about 4/3 of n.
</p>
<p>
If n is not specified, 16 is assumed. It may be larger in future.
</p>
<p>
If secure random number generator is not available, NotImplementedError is
raised.
</p>
</div><!--description-->
<!--ENDIF:m_desc-->
<!--IF:sourcecode -->
<div class="sourcecode">
<h2>Source Code</h2>
<pre>
     <span class="ruby-comment cmt"># File lib/secure_random.rb, line 105</span>
105:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">base64</span>(<span class="ruby-identifier">n</span>=<span class="ruby-keyword kw">nil</span>)
106:     [<span class="ruby-identifier">random_bytes</span>(<span class="ruby-identifier">n</span>)].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">&quot;m*&quot;</span>).<span class="ruby-identifier">delete</span>(<span class="ruby-value str">&quot;\n&quot;</span>)
107:   <span class="ruby-keyword kw">end</span>
</pre>
</div><!--sourcecode-->
<!-- ENDIF:sourcecode-->
<!-- END methods -->
<!--START:methods-->
<h2 class="methodname"><a name="M000008">

 <b>hex</b>(n=nil)
</a>
</h2>

<!--IF:m_desc-->
<div class="description">
<p>
<a href="SecureRandom.html#M000008">SecureRandom.hex</a> generates a random
<a href="SecureRandom.html#M000008">hex</a> string.
</p>
<p>
The argument n specifies the length of the random length. The length of the
result string is twice of n.
</p>
<p>
If n is not specified, 16 is assumed. It may be larger in future.
</p>
<p>
If secure random number generator is not available, NotImplementedError is
raised.
</p>
</div><!--description-->
<!--ENDIF:m_desc-->
<!--IF:sourcecode -->
<div class="sourcecode">
<h2>Source Code</h2>
<pre>
    <span class="ruby-comment cmt"># File lib/secure_random.rb, line 91</span>
91:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">hex</span>(<span class="ruby-identifier">n</span>=<span class="ruby-keyword kw">nil</span>)
92:     <span class="ruby-identifier">random_bytes</span>(<span class="ruby-identifier">n</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">&quot;H*&quot;</span>)[<span class="ruby-value">0</span>]
93:   <span class="ruby-keyword kw">end</span>
</pre>
</div><!--sourcecode-->
<!-- ENDIF:sourcecode-->
<!-- END methods -->
<!--START:methods-->
<h2 class="methodname"><a name="M000007">

 <b>random_bytes</b>(n=nil)
</a>
</h2>

<!--IF:m_desc-->
<div class="description">
<p>
<a href="SecureRandom.html#M000007">SecureRandom.random_bytes</a> generates
a random binary string.
</p>
<p>
The argument n specifies the length of the result string.
</p>
<p>
If n is not specified, 16 is assumed. It may be larger in future.
</p>
<p>
If secure random number generator is not available, NotImplementedError is
raised.
</p>
</div><!--description-->
<!--ENDIF:m_desc-->
<!--IF:sourcecode -->
<div class="sourcecode">
<h2>Source Code</h2>
<pre>
    <span class="ruby-comment cmt"># File lib/secure_random.rb, line 51</span>
51:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">random_bytes</span>(<span class="ruby-identifier">n</span>=<span class="ruby-keyword kw">nil</span>)
52:     <span class="ruby-identifier">n</span> <span class="ruby-operator">||=</span> <span class="ruby-value">16</span>
53:     <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Random</span>
54:       <span class="ruby-keyword kw">return</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Random</span>.<span class="ruby-identifier">random_bytes</span>(<span class="ruby-identifier">n</span>)
55:     <span class="ruby-keyword kw">end</span>
56:     <span class="ruby-keyword kw">if</span> <span class="ruby-operator">!</span><span class="ruby-keyword kw">defined?</span>(<span class="ruby-ivar">@has_urandom</span>) <span class="ruby-operator">||</span> <span class="ruby-ivar">@has_urandom</span>
57:       <span class="ruby-ivar">@has_urandom</span> = <span class="ruby-keyword kw">false</span>
58:       <span class="ruby-identifier">flags</span> = <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">RDONLY</span>
59:       <span class="ruby-identifier">flags</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">NONBLOCK</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">NONBLOCK</span>
60:       <span class="ruby-identifier">flags</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">NOCTTY</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">NOCTTY</span>
61:       <span class="ruby-identifier">flags</span> <span class="ruby-operator">|=</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">NOFOLLOW</span> <span class="ruby-keyword kw">if</span> <span class="ruby-keyword kw">defined?</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">NOFOLLOW</span>
62:       <span class="ruby-keyword kw">begin</span>
63:         <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-value str">&quot;/dev/urandom&quot;</span>, <span class="ruby-identifier">flags</span>) {<span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
64:           <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">f</span>.<span class="ruby-identifier">stat</span>.<span class="ruby-identifier">chardev?</span>
65:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span>
66:           <span class="ruby-keyword kw">end</span>
67:           <span class="ruby-ivar">@has_urandom</span> = <span class="ruby-keyword kw">true</span>
68:           <span class="ruby-identifier">ret</span> = <span class="ruby-identifier">f</span>.<span class="ruby-identifier">readpartial</span>(<span class="ruby-identifier">n</span>)
69:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">!=</span> <span class="ruby-identifier">n</span>
70:             <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>, <span class="ruby-value str">&quot;Unexpected partial read from random device&quot;</span>
71:           <span class="ruby-keyword kw">end</span>
72:           <span class="ruby-keyword kw">return</span> <span class="ruby-identifier">ret</span>
73:         }
74:       <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span>
75:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>, <span class="ruby-value str">&quot;No random device&quot;</span>
76:       <span class="ruby-keyword kw">end</span>
77:     <span class="ruby-keyword kw">end</span>
78:     <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotImplementedError</span>, <span class="ruby-value str">&quot;No random device&quot;</span>
79:   <span class="ruby-keyword kw">end</span>
</pre>
</div><!--sourcecode-->
<!-- ENDIF:sourcecode-->
<!-- END methods -->
<!--START:methods-->
<h2 class="methodname"><a name="M000010">

 <b>random_number</b>(n=0)
</a>
</h2>

<!--IF:m_desc-->
<div class="description">
<p>
<a href="SecureRandom.html#M000010">SecureRandom.random_number</a>
generates a random number.
</p>
<p>
If an positive integer is given as n, <a
href="SecureRandom.html#M000010">SecureRandom.random_number</a> returns an
integer: 0 &lt;= <a
href="SecureRandom.html#M000010">SecureRandom.random_number(n)</a> &lt; n.
</p>
<p>
If 0 is given or an argument is not given, <a
href="SecureRandom.html#M000010">SecureRandom.random_number</a> returns an
float: 0.0 &lt;= <a
href="SecureRandom.html#M000010">SecureRandom.random_number</a>() &lt; 1.0.
</p>
</div><!--description-->
<!--ENDIF:m_desc-->
<!--IF:sourcecode -->
<div class="sourcecode">
<h2>Source Code</h2>
<pre>
     <span class="ruby-comment cmt"># File lib/secure_random.rb, line 118</span>
118:   <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">random_number</span>(<span class="ruby-identifier">n</span>=<span class="ruby-value">0</span>)
119:     <span class="ruby-keyword kw">if</span> <span class="ruby-value">0</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">n</span>
120:       <span class="ruby-identifier">hex</span> = <span class="ruby-identifier">n</span>.<span class="ruby-identifier">to_s</span>(<span class="ruby-value">16</span>)
121:       <span class="ruby-identifier">hex</span> = <span class="ruby-value str">'0'</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">hex</span> <span class="ruby-keyword kw">if</span> (<span class="ruby-identifier">hex</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&amp;</span> <span class="ruby-value">1</span>) <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
122:       <span class="ruby-identifier">bin</span> = [<span class="ruby-identifier">hex</span>].<span class="ruby-identifier">pack</span>(<span class="ruby-value str">&quot;H*&quot;</span>)
123:       <span class="ruby-identifier">mask</span> = <span class="ruby-identifier">bin</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span>
124:       <span class="ruby-identifier">mask</span> <span class="ruby-operator">|=</span> <span class="ruby-identifier">mask</span> <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">1</span>
125:       <span class="ruby-identifier">mask</span> <span class="ruby-operator">|=</span> <span class="ruby-identifier">mask</span> <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">2</span>
126:       <span class="ruby-identifier">mask</span> <span class="ruby-operator">|=</span> <span class="ruby-identifier">mask</span> <span class="ruby-operator">&gt;&gt;</span> <span class="ruby-value">4</span>
127:       <span class="ruby-keyword kw">begin</span>
128:         <span class="ruby-identifier">rnd</span> = <span class="ruby-constant">SecureRandom</span>.<span class="ruby-identifier">random_bytes</span>(<span class="ruby-identifier">bin</span>.<span class="ruby-identifier">length</span>)
129:         <span class="ruby-identifier">rnd</span>[<span class="ruby-value">0</span>] = (<span class="ruby-identifier">rnd</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">ord</span> <span class="ruby-operator">&amp;</span> <span class="ruby-identifier">mask</span>).<span class="ruby-identifier">chr</span>
130:       <span class="ruby-keyword kw">end</span> <span class="ruby-keyword kw">until</span> <span class="ruby-identifier">rnd</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">bin</span>
131:       <span class="ruby-identifier">rnd</span>.<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">&quot;H*&quot;</span>)[<span class="ruby-value">0</span>].<span class="ruby-identifier">hex</span>
132:     <span class="ruby-keyword kw">else</span>
133:       <span class="ruby-comment cmt"># assumption: Float::MANT_DIG &lt;= 64</span>
134:       <span class="ruby-identifier">i64</span> = <span class="ruby-constant">SecureRandom</span>.<span class="ruby-identifier">random_bytes</span>(<span class="ruby-value">8</span>).<span class="ruby-identifier">unpack</span>(<span class="ruby-value str">&quot;Q&quot;</span>)[<span class="ruby-value">0</span>]
135:       <span class="ruby-constant">Math</span>.<span class="ruby-identifier">ldexp</span>(<span class="ruby-identifier">i64</span> <span class="ruby-operator">&gt;&gt;</span> (<span class="ruby-value">64</span><span class="ruby-operator">-</span><span class="ruby-constant">Float</span><span class="ruby-operator">::</span><span class="ruby-constant">MANT_DIG</span>), <span class="ruby-operator">-</span><span class="ruby-constant">Float</span><span class="ruby-operator">::</span><span class="ruby-constant">MANT_DIG</span>)
136:     <span class="ruby-keyword kw">end</span>
137:   <span class="ruby-keyword kw">end</span>
</pre>
</div><!--sourcecode-->
<!-- ENDIF:sourcecode-->
<!-- END methods -->
</div><!--methods-->
<!--ENDIF:methods-->
</div><!-- END method_list -->
</div><!-- ENDIF method_list -->
  <!-- method descriptions -->


</div><!-- indent -->
</body>
</html>